server {
    index index.php index.html;
    client_max_body_size 10M;
    server_name localhost;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    root /backoffice;


    # copy pste from vhost.conf
    try_files $uri $uri/ =404;

    rewrite ^/poi/([a-z0-9]+)\.svg$ /?name=svg&extension=html&color=$1&$query_string last;

    # Réécritures JS / CSS
    rewrite ^/([a-z0-9/\.-]+)\.(css|js)$ /?name=$1&extension=$2 last;
    location /lib {
        rewrite ^/lib/([a-z0-9/\.-]+)\.(.*)$ /?name=index&extension=$2 last;
    }
    
    rewrite ^/edit/([a-z-]+)/([^@]+)\.html$ /?name=edit/$1&extension=html&id=$2&$query_string last;
    rewrite ^/edit/([a-z-]+)/@(.*)\.html$ /?name=edit/$1&extension=html&parent=$2&$query_string last;


    rewrite ^/delete/([a-z-]+)/(.*)\.html$ /?name=delete/$1&extension=html&$query_string&id=$2 last;
    rewrite ^/upload/([a-z0-9/._-]+)$ /?name=upload&extension=html&hash=$1&$query_string last;


    #rewrite index\.(html|admin|popup)$ /?name=index&extension=$1 last;
    #rewrite /(.*)\.(html|admin|popup)$ /?name=$1&extension=$2&$query_string last;
    if ($query_string ~ "(.*)") {
            rewrite ^/([a-zA-Z0-9._/-]+)\.(admin|ajax|html|popup|pro|mail|api)$ /index.php?name=$1&extension=$2&%1 break; 
    }

    

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}